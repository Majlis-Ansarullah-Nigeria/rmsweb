@page "/report-submission"
@using MudBlazor
@using System.Collections.Generic
@using System.Linq

@inject IStringLocalizer<ReportSubmission> L

@if (!_loaded)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
}
else
{
    <MudTabs Elevation="25" Rounded="true" Centered="true" ApplyEffectsToContainer="true" AlwaysShowScrollButtons="true">
        @foreach (var section in Report.Sections)
        {
            var allQuestionsInSection = section.Questions.ToList();
            var title = section.Title;
            var answeredQuestionsCount = section.Questions.Count(q => IsQuestionAnswered(q));
            var badgeColor = answeredQuestionsCount == allQuestionsInSection.Count ? Color.Success : Color.Error;

            <MudTabPanel Text="@title" BadgeData="@($"{answeredQuestionsCount}/{allQuestionsInSection.Count}")" BadgeColor="@badgeColor">
                <div class="mt-3">
                    @foreach (var question in section.Questions)
                    {
                        <div class="mb-3">
                            <span class="font-weight-bold">@question.Text</span>
                            <div class="mt-2">
                                @switch (question.ResponseType)
                                {
                                    case ResponseType.Checkbox:
                                       @* <MudCheckBox @bind-Checked="false" Label="@L["Yes"]" Color="Color.Primary" />*@
                                        break;
                                    case ResponseType.Integer:
                                        <MudNumericField T="int?" @*@bind-Value=""*@ />
                                        break;
                                    case ResponseType.Dropdown:
@*                                        <MudSelect @bind-Value="@question.Answer">
                                            @foreach (var option in question.DropdownOptions)
                                            {
                                                <MudOption Value="@option" Label="@option" />
                                            }
                                        </MudSelect>*@
                                        break;
                                   @* case QuestionInputType.Radio:
                                        <div class="d-flex flex-wrap">
                                            @foreach (var option in question.DropdownOptions)
                                            {
                                                <div class="mr-3">
                                                    <MudRadio Group="@question.RadioGroup" Value="@option" Label="@option" />
                                                </div>
                                            }
                                        </div>
                                        break;*@
                                    case ResponseType.Date:
                                      @*  <MudDatePicker @bind-Date="DateTime.Now" />*@
                                        break;
                                    case ResponseType.File:
                                        <MudFileInput OnChange="HandleFileUpload" />
                                        break;
                                    case ResponseType.TextInput:
                                    default:
                                        @*<MudTextField @bind-Value="@question.Answer" FullWidth="true" />*@
                                        break;
                                }
                            </div>
                        </div>
                    }
                </div>
                @*<div class="text-right mt-3">
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="() => SaveSection(section)">
                        @L["Save"]
                    </MudButton>
                </div>*@
            </MudTabPanel>
        }
    </MudTabs>
    <div class="text-right mt-3">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveReport">
            @L["Submit"]
        </MudButton>
    </div>
}
